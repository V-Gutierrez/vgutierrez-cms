<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Victor Gutierrez CMS - Admin</title>
    <link rel="stylesheet" href="css/admin.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Monaco Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs/loader.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Loading Screen -->
        <div id="loading-screen" class="loading-screen">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
            </div>
            <p>Carregando CMS...</p>
        </div>

        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-cogs"></i> VG CMS</h2>
                <button class="sidebar-toggle" id="sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <ul class="sidebar-menu">
                <li class="menu-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </li>
                <li class="menu-item" data-section="blog">
                    <i class="fas fa-blog"></i>
                    <span>Blog Posts</span>
                </li>
                <li class="menu-item" data-section="gallery">
                    <i class="fas fa-images"></i>
                    <span>Galeria</span>
                </li>
                <li class="menu-item" data-section="library">
                    <i class="fas fa-photo-video"></i>
                    <span>Assets Management</span>
                </li>
                <li class="menu-item" data-section="profile">
                    <i class="fas fa-user"></i>
                    <span>Perfil</span>
                </li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <h1 id="page-title">Dashboard</h1>
                <div class="header-actions">
                    <button class="btn btn-git-commit" id="git-commit-btn" title="Fazer commit das mudan√ßas">
                        <i class="fas fa-code-branch"></i>
                        <span>Commit</span>
                        <span class="btn-badge commit-badge" id="commit-badge" style="display: none;">0</span>
                    </button>
                    <button class="btn btn-git-push" id="git-push-btn" title="Fazer push para o reposit√≥rio">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Push</span>
                        <span class="btn-badge push-badge" id="push-badge" style="display: none;">0</span>
                    </button>
                    <button class="btn btn-primary" id="primary-action" style="display: none;">
                        <i class="fas fa-plus"></i>
                        <span>Novo Item</span>
                    </button>
                </div>
            </header>

            <!-- Content Sections -->
            <div class="content-wrapper">
                <!-- Dashboard Section -->
                <section id="section-dashboard" class="content-section active">
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <i class="fas fa-blog"></i>
                            <div class="stat-info">
                                <h3 id="blog-count">-</h3>
                                <p>Posts no Blog</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-images"></i>
                            <div class="stat-info">
                                <h3 id="gallery-count">-</h3>
                                <p>Itens na Galeria</p>
                            </div>
                        </div>
                    </div>

                    <div class="recent-activity">
                        <h2>Atividade Recente</h2>
                        <div class="activity-list" id="recent-activity">
                            <p class="no-data">Carregando atividades...</p>
                        </div>
                    </div>
                </section>

                <!-- Blog Section -->
                <section id="section-blog" class="content-section">
                    <div class="section-controls">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="blog-search" placeholder="Buscar posts...">
                        </div>
                    </div>

                    <div class="items-grid" id="blog-grid">
                        <p class="no-data">Carregando posts...</p>
                    </div>
                </section>


                <!-- Gallery Section -->
                <section id="section-gallery" class="content-section">
                    <div class="items-grid gallery-grid" id="gallery-grid">
                        <p class="no-data">Carregando galeria...</p>
                    </div>
                </section>

                <!-- Library Section -->
                <section id="section-library" class="content-section">
                    <div class="library-grid" id="library-grid">
                        <p class="no-data">Carregando biblioteca de imagens...</p>
                    </div>
                </section>

                <!-- Profile Section -->
                <section id="section-profile" class="content-section">
                    <div class="profile-content" id="profile-content">
                        <p class="no-data">Carregando perfil...</p>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Modal for Create/Edit -->
    <div class="modal" id="item-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Novo Item</h3>
                <button class="modal-close" id="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Dynamic content will be inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">Cancelar</button>
                <button class="btn btn-primary" id="modal-save">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/editor.js"></script>
    <script src="js/app.js"></script>

    <!-- Live Reload for Development -->
    <script>
        (function() {
            // Only enable in development (when running on localhost)
            if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
                return;
            }

            let lastServerTimestamp = null;
            let isFirstCheck = true;

            async function checkServerHeartbeat() {
                try {
                    const response = await fetch('/api/dev/heartbeat');
                    if (!response.ok) return;

                    const data = await response.json();
                    const currentTimestamp = data.timestamp;

                    if (lastServerTimestamp === null) {
                        // First check - just store the timestamp
                        lastServerTimestamp = currentTimestamp;
                        isFirstCheck = false;
                    } else if (currentTimestamp !== lastServerTimestamp) {
                        // Server restarted - reload the page
                        console.log('üîÑ Server restarted - reloading page...');
                        window.location.reload();
                    }
                } catch (error) {
                    // Server is probably down/restarting - wait for it to come back
                    console.log('‚è≥ Waiting for server...');
                }
            }

            // Check every 2 seconds
            setInterval(checkServerHeartbeat, 2000);

            // Initial check
            checkServerHeartbeat();

            console.log('üî• Live reload enabled');
        })();
    </script>
</body>
</html>
